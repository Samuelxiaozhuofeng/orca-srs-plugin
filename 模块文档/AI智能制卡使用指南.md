# AI 智能制卡功能使用指南

## 功能概述

AI 智能制卡是一个交互式的卡片生成功能，它能够：
1. 自动分析块内容，提取知识点
2. 通过弹窗让用户选择要制作的知识点
3. 支持自定义输入额外的知识点
4. 根据用户选择的卡片类型（Basic / Cloze）生成多张卡片
5. 自动插入到原始块下方

## 使用方法

### 1. 配置 AI 服务

首先确保已在插件设置中配置好 AI 服务：
- **API Key**: OpenAI 兼容的 API Key
- **API URL**: API 端点地址（默认：`https://api.openai.com/v1/chat/completions`）
- **AI Model**: 使用的模型（默认：`gpt-3.5-turbo`）

### 2. 启动智能制卡

有两种方式启动：

**方式一：斜杠命令**
1. 在要制卡的块中输入 `/`
2. 搜索 "AI 智能制卡（交互式）"
3. 选择该命令

**方式二：命令面板**
1. 按 `Ctrl+P` / `Cmd+P` 打开命令面板
2. 搜索 "SRS: AI 智能制卡（交互式）"
3. 执行命令

### 3. 交互式选择

弹窗会显示：

#### 原始内容预览
显示你选中的块内容

#### 检测到的知识点
AI 自动提取的知识点列表，每个知识点包含：
- ✅ 复选框（默认勾选 AI 推荐的知识点）
- 知识点文本
- 简短说明
- 难度评级（⭐ 1-5 星）

#### 自定义知识点
输入框，可以添加 AI 未检测到的知识点

#### 卡片类型选择
- **📝 Basic Card（问答卡）**: 生成问题-答案格式的卡片
- **🔤 Cloze Card（填空卡）**: 生成挖空格式的卡片

### 4. 生成卡片

点击"生成 N 张卡片"按钮，AI 会：
1. 根据选中的知识点生成卡片
2. 遵循最小知识点原则（每张卡片只测试一个概念）
3. 自动插入到原始块下方
4. 添加 `#card` 标签并初始化 SRS 状态

## 使用示例

### 示例 1：日语语法学习

**原始内容**：
```
使役形（～させる）+ ない：不让/不准（某人）做某事
```

**AI 分析结果**：
- ☑ 使役形（～させる）
- ☑ ない的否定用法
- ☐ 使役形 + ない 的组合规则

**选择 Basic Card 后生成**：
```
使役形（～させる）+ ない：不让/不准（某人）做某事
  └── 使役形（～させる）的基本用法是什么？ #card
      └── 表示让某人做某事，动词变形规则：五段动词词尾变あ段+せる，一段动词去る+させる
  └── ない在动词后面表示什么意思？ #card
      └── 表示否定，即不做某事
```

### 示例 2：概念定义记忆

**原始内容**：
```
光合作用是植物利用阳光将二氧化碳和水转化为葡萄糖的过程
```

**选择 Cloze Card 后生成**：
```
光合作用是植物利用阳光将二氧化碳和水转化为葡萄糖的过程
  └── 光合作用是植物利用阳光将二氧化碳和水转化为[葡萄糖]的过程 #card
  └── [光合作用]是植物利用阳光将二氧化碳和水转化为葡萄糖的过程 #card
```

## 技术细节

### 文件结构

```
src/srs/ai/
├── aiKnowledgeExtractor.ts      # 知识点提取服务
├── aiCardGenerators.ts          # 卡片生成器（Basic/Cloze）
├── aiInteractiveCardCreator.ts  # 交互式创建逻辑
└── aiCardCreator.ts             # 原有的简单 AI 制卡

src/components/
└── AICardGenerationDialog.tsx   # 交互式弹窗组件
```

### AI 提示词设计

**知识点提取提示词**：
- 要求 AI 识别 2-5 个独立的知识点
- 每个知识点应该是原子化的
- 评估难度并标记推荐制卡的知识点

**Basic Card 生成提示词**：
- 为每个知识点生成 1-2 张卡片
- 遵循最小知识点原则
- 问题清晰、答案简洁

**Cloze Card 生成提示词**：
- 选择关键词进行挖空
- 确保挖空后句子仍有意义
- 可提供记忆提示

### 与原有功能的区别

| 功能 | 原有 AI 制卡 | 新增智能制卡 |
|------|-------------|-------------|
| 交互方式 | 直接生成 | 弹窗交互选择 |
| 知识点控制 | 无法控制 | 可勾选/自定义 |
| 卡片数量 | 固定 1 张 | 动态生成多张 |
| 卡片类型 | 仅 Basic | Basic / Cloze |
| 适用场景 | 快速制卡 | 精细化学习 |

## 常见问题

### Q: 为什么没有检测到知识点？
A: 可能是内容过于简单或格式不适合。可以使用"自定义知识点"输入框手动添加。

### Q: 生成的卡片质量不好怎么办？
A: 可以：
1. 调整 AI 设置中的模型（使用更强大的模型如 GPT-4）
2. 修改提示词模板
3. 使用自定义输入更精确地描述要学习的内容

### Q: 可以批量生成吗？
A: 当前版本每次处理一个块。如需批量处理，可以多次执行命令。

### Q: 支持其他语言吗？
A: 支持。在插件设置中修改"生成语言"即可。

## 后续优化方向

1. **批量处理**: 支持一次选中多个块
2. **卡片预览**: 生成前预览卡片内容
3. **质量评分**: AI 对生成的卡片进行质量评估
4. **模板系统**: 预设不同学科的提示词模板
5. **历史记录**: 保存用户的选择偏好

## 反馈与建议

如有问题或建议，请通过以下方式反馈：
- 提交 Issue
- 在讨论区留言
