# Change: add-list-card-type（新增“列表卡”卡片类型）

## Why（为什么要做）

当前插件支持 Basic/Cloze/Direction/Excerpt/Choice 等卡片类型，但缺少对“按顺序学习一组条目”的原生支持。用户希望将一个列表（如 1～N）制作成一种可逐条推送的卡片：每个条目独立评分与调度，并且在用户遗忘/困难时对后续条目进行“推迟到明天”的安排，同时允许当日继续预览后续条目作为辅助练习。

## What Changes（要改什么）

- 新增卡片类型：`#card(type=list)`（列表卡）
- 新增斜杠命令：`列表卡`（参考“转换为记忆卡片”注册方式）
  - 将当前块转换为列表卡：自动添加 `#card` 标签、注入 `type=list`
  - 初始化列表条目的 SRS 状态
- 复习队列与复习渲染：
  - 列表卡由多个“条目子卡”组成（按顺序 1..N）
  - 条目逐次推送：只有当条目评分为 `good/easy` 才会继续推送下一个条目（正式复习）
  - 若条目评分为 `again/hard`：
    - 后续条目（i+1..N）在正式调度上“安排到明天”
    - 当日仍可继续展示后续条目作为“辅助预览”，但不计入正式统计与记忆收益
- 统计与复习日志：
  - 为列表条目引入可区分的“子卡唯一键”，避免与同一父块的其他条目混淆
  - “辅助预览”不写入复习日志、不更新 SRS 状态（不计入正式统计）

## Non-Goals（不做什么）

- 不在本次变更中新增复杂的列表条目解析（例如解析多层嵌套列表、Markdown 有序/无序列表的所有变体）
- 不引入新的 FSRS 算法参数或权重体系（复用现有 FSRS）
- 不实现跨块/跨笔记的列表聚合（仅处理单个列表卡块）

## Assumptions（关键假设）

- 列表条目来源于列表卡块的**直接子块**（children），按出现顺序 1..N 作为条目顺序。
- 列表条目“身份映射”优先使用子块的 `blockId`（稳定、可重排、可编辑）；新增/删除子块会产生新的条目（新进度）。
- 当进入“辅助预览”阶段时仍允许用户评分，但系统会明确提示“该评分不计入统计/不更新 SRS”。

## Impact（影响范围）

- 受影响模块（预期）：
  - 命令与斜杠命令注册：`src/srs/registry/uiComponents.tsx`、`src/srs/registry/commands.ts`
  - 卡片类型识别：`src/srs/deckUtils.ts`、`src/srs/types.ts`
  - 卡片收集与队列：`src/srs/cardCollector.ts`、`src/components/SrsReviewSessionDemo.tsx`
  - SRS 存储：`src/srs/storage.ts`、`src/srs/cardStatusUtils.ts`（推迟/埋藏能力扩展）
  - 复习渲染：`src/components/SrsCardDemo.tsx`（新增 list 渲染分支，或复用现有渲染）
  - 统计：`src/srs/reviewLogStorage.ts`、`src/srs/statisticsManager.ts`

## Risks（风险）

- 需要定义“子卡唯一键”后，复习日志与统计逻辑可能涉及兼容与迁移。
- 列表条目与块结构强绑定：若用户编辑/重排子块，条目顺序与历史进度的对应关系需要明确规则。

## Open Questions（待确认）

1. 列表条目是否只取“直接子块”，还是需要支持从父块文本中解析多行 `-` 列表？
   - 决策：只取直接子块（本变更不解析父块多行列表文本）。
2. “辅助预览”阶段是否允许用户继续点击评分按钮？
   - 决策：允许评分，但提醒不计入统计且不更新 SRS。
3. 当用户重排/删除/新增条目时：已存在的条目 SRS 状态如何映射？
   - 决策：以子块 `blockId` 作为稳定映射；新增/删除子块视为条目变更，不尝试跨条目迁移进度。
