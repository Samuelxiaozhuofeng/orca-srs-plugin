# 需求文档

## 简介

为 Flash Home 添加类似 Anki 的统计功能，提供全面的学习数据可视化和分析能力。该功能将帮助用户了解自己的学习进度、复习效率和记忆状态，从而优化学习策略。

Anki 统计功能包括：
1. **今日统计** - 今天的复习情况概览
2. **未来到期预测** - 未来一段时间内的复习负载预测
3. **复习历史** - 过去一段时间的复习记录
4. **卡片状态分布** - 新卡/学习中/已掌握的比例
5. **答题按钮统计** - Again/Hard/Good/Easy 的使用分布
6. **复习时间统计** - 每天花费的复习时间
7. **卡片间隔分布** - 卡片复习间隔的分布情况
8. **卡片难度分布** - 卡片难度值的分布情况

## 术语表

- **统计系统 (Statistics_System)**: 负责收集、计算和展示学习数据的模块
- **复习记录 (Review_Log)**: 单次复习的详细信息，包括时间、评分、耗时等
- **卡片状态 (Card_State)**: 卡片的学习阶段，包括新卡、学习中、复习中、重学中
- **复习间隔 (Review_Interval)**: 两次复习之间的天数
- **难度值 (Difficulty)**: FSRS 算法计算的卡片难度，范围 1-10
- **稳定性 (Stability)**: FSRS 算法计算的记忆稳定度
- **时间范围 (Time_Range)**: 统计数据的时间跨度，如 1 个月、3 个月、1 年、全部

## 需求

### 需求 1

**用户故事:** 作为学习者，我想查看今日复习统计，以便了解今天的学习进度。

#### 验收标准

1. WHEN 用户打开统计页面 THEN 统计系统 SHALL 显示今日已复习卡片数量
2. WHEN 用户打开统计页面 THEN 统计系统 SHALL 显示今日各评分按钮（Again/Hard/Good/Easy）的使用次数
3. WHEN 用户打开统计页面 THEN 统计系统 SHALL 显示今日复习花费的总时间
4. WHEN 用户打开统计页面 THEN 统计系统 SHALL 显示今日新学卡片数量
5. WHEN 用户打开统计页面 THEN 统计系统 SHALL 显示今日重学卡片数量（按了 Again 的卡片）

### 需求 2

**用户故事:** 作为学习者，我想查看未来到期预测图表，以便规划我的复习时间。

#### 验收标准

1. WHEN 用户查看未来到期预测 THEN 统计系统 SHALL 显示未来 30 天内每天到期的卡片数量柱状图
2. WHEN 用户查看未来到期预测 THEN 统计系统 SHALL 区分显示复习卡和新卡的到期数量
3. WHEN 用户查看未来到期预测 THEN 统计系统 SHALL 显示累计到期卡片数量趋势线
4. WHEN 用户悬停在图表柱状条上 THEN 统计系统 SHALL 显示该日期的具体到期数量

### 需求 3

**用户故事:** 作为学习者，我想查看复习历史图表，以便了解我的学习规律。

#### 验收标准

1. WHEN 用户查看复习历史 THEN 统计系统 SHALL 显示过去一段时间内每天的复习卡片数量柱状图
2. WHEN 用户查看复习历史 THEN 统计系统 SHALL 按评分类型（Again/Hard/Good/Easy）分色显示堆叠柱状图
3. WHEN 用户选择不同时间范围 THEN 统计系统 SHALL 更新图表显示对应时间段的数据
4. WHEN 用户悬停在图表柱状条上 THEN 统计系统 SHALL 显示该日期各评分的具体数量

### 需求 4

**用户故事:** 作为学习者，我想查看卡片状态分布，以便了解我的整体学习进度。

#### 验收标准

1. WHEN 用户查看卡片状态分布 THEN 统计系统 SHALL 显示新卡、学习中、已掌握卡片的数量和百分比
2. WHEN 用户查看卡片状态分布 THEN 统计系统 SHALL 以饼图或环形图形式展示分布
3. WHEN 用户查看卡片状态分布 THEN 统计系统 SHALL 显示暂停/搁置卡片的数量（如果有）
4. WHEN 用户点击某个状态区域 THEN 统计系统 SHALL 显示该状态的详细信息

### 需求 5

**用户故事:** 作为学习者，我想查看复习时间统计，以便了解我的学习时间投入。

#### 验收标准

1. WHEN 用户查看复习时间统计 THEN 统计系统 SHALL 显示过去一段时间内每天的复习时间柱状图
2. WHEN 用户查看复习时间统计 THEN 统计系统 SHALL 显示平均每天复习时间
3. WHEN 用户查看复习时间统计 THEN 统计系统 SHALL 显示总复习时间
4. WHEN 用户选择不同时间范围 THEN 统计系统 SHALL 更新图表显示对应时间段的数据

### 需求 6

**用户故事:** 作为学习者，我想查看卡片间隔分布，以便了解我的记忆巩固情况。

#### 验收标准

1. WHEN 用户查看卡片间隔分布 THEN 统计系统 SHALL 显示所有卡片按复习间隔分组的柱状图
2. WHEN 用户查看卡片间隔分布 THEN 统计系统 SHALL 使用对数刻度分组（如 0-1天、1-3天、3-7天、7-14天、14-30天、30-90天、90天以上）
3. WHEN 用户查看卡片间隔分布 THEN 统计系统 SHALL 显示平均间隔天数
4. WHEN 用户悬停在图表柱状条上 THEN 统计系统 SHALL 显示该间隔范围内的卡片数量

### 需求 7

**用户故事:** 作为学习者，我想查看答题按钮使用统计，以便了解我的答题习惯。

#### 验收标准

1. WHEN 用户查看答题按钮统计 THEN 统计系统 SHALL 显示 Again/Hard/Good/Easy 四个按钮的使用次数和百分比
2. WHEN 用户查看答题按钮统计 THEN 统计系统 SHALL 以饼图或柱状图形式展示分布
3. WHEN 用户选择不同时间范围 THEN 统计系统 SHALL 更新统计显示对应时间段的数据
4. WHEN 用户查看答题按钮统计 THEN 统计系统 SHALL 显示正确率（Good + Easy 的百分比）

### 需求 8

**用户故事:** 作为学习者，我想选择不同的统计时间范围，以便查看不同时期的学习数据。

#### 验收标准

1. WHEN 用户打开统计页面 THEN 统计系统 SHALL 提供时间范围选择器（1个月、3个月、1年、全部）
2. WHEN 用户选择时间范围 THEN 统计系统 SHALL 更新所有相关图表和统计数据
3. WHEN 用户选择时间范围 THEN 统计系统 SHALL 记住用户的选择偏好
4. WHEN 用户首次打开统计页面 THEN 统计系统 SHALL 默认显示 1 个月的数据

### 需求 9

**用户故事:** 作为学习者，我想查看按牌组筛选的统计数据，以便了解特定牌组的学习情况。

#### 验收标准

1. WHEN 用户打开统计页面 THEN 统计系统 SHALL 提供牌组筛选器
2. WHEN 用户选择特定牌组 THEN 统计系统 SHALL 只显示该牌组的统计数据
3. WHEN 用户选择"全部牌组" THEN 统计系统 SHALL 显示所有牌组的汇总统计
4. WHEN 用户切换牌组筛选 THEN 统计系统 SHALL 更新所有图表和统计数据

### 需求 10

**用户故事:** 作为学习者，我想查看卡片难度分布，以便了解我的卡片难度情况。

#### 验收标准

1. WHEN 用户查看卡片难度分布 THEN 统计系统 SHALL 显示所有卡片按难度值分组的柱状图
2. WHEN 用户查看卡片难度分布 THEN 统计系统 SHALL 显示平均难度值
3. WHEN 用户查看卡片难度分布 THEN 统计系统 SHALL 显示难度值的分布范围（最小值、最大值）
4. WHEN 用户悬停在图表柱状条上 THEN 统计系统 SHALL 显示该难度范围内的卡片数量

### 需求 11

**用户故事:** 作为学习者，我想持久化存储复习记录，以便统计系统能够计算历史数据。

#### 验收标准

1. WHEN 用户完成一次卡片复习 THEN 统计系统 SHALL 记录复习时间戳、评分、耗时、卡片ID
2. WHEN 统计系统存储复习记录 THEN 统计系统 SHALL 使用 orca.plugins.setData 持久化数据
3. WHEN 统计系统读取复习记录 THEN 统计系统 SHALL 能够正确解析存储的数据格式
4. IF 存储空间不足 THEN 统计系统 SHALL 自动清理超过 1 年的旧记录

### 需求 12

**用户故事:** 作为学习者，我想在 Flash Home 中快速访问统计功能，以便方便地查看学习数据。

#### 验收标准

1. WHEN 用户在 Flash Home 页面 THEN 统计系统 SHALL 在顶部显示统计入口按钮
2. WHEN 用户点击统计按钮 THEN 统计系统 SHALL 切换到统计视图
3. WHEN 用户在统计视图 THEN 统计系统 SHALL 提供返回牌组列表的按钮
4. WHEN 用户切换视图 THEN 统计系统 SHALL 保持流畅的过渡动画

